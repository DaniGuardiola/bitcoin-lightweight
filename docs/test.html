<!DOCTYPE html>

<html>
<head>
  <title>test.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="main.html">
                  main.js
                </a>
              
                
                <a class="source" href="quick-testing.html">
                  quick-testing.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>test.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* eslint-env mocha */</span>
<span class="hljs-keyword">const</span> chai = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>)
chai.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">'chai-as-promised'</span>))

<span class="hljs-keyword">const</span> bip39 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bip39'</span>)
<span class="hljs-keyword">const</span> bitcoin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bitcoinjs-lib'</span>)

<span class="hljs-keyword">const</span> Wallet = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./main'</span>)

chai.should()

<span class="hljs-keyword">const</span> OPTIONS_DISABLE_NETWORK = {
  <span class="hljs-attr">__testsDisableNetwork</span>: <span class="hljs-literal">true</span>
}

describe(<span class="hljs-string">'Wallet'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> INCORRECT_TYPE = <span class="hljs-string">'this_type_does_not_exist'</span>
  <span class="hljs-keyword">const</span> CORRECT_TYPE = <span class="hljs-string">'bitcoin_electrum_BIP39_BIP49'</span>
  <span class="hljs-keyword">const</span> CORRECT_SECRET = bip39.generateMnemonic()

  it(<span class="hljs-string">'throws if no parameters are passed'</span>, () =&gt; {
    ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet()).should.throw()
  })

  it(<span class="hljs-string">'throws if incorrect wallet type is passed'</span>, () =&gt; {
    ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(INCORRECT_TYPE, CORRECT_SECRET)).should.throw()
  })

  it(<span class="hljs-string">'does not throw if correct wallet type and secret is passed (BIP39)'</span>, () =&gt; {
    ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(CORRECT_TYPE, CORRECT_SECRET, OPTIONS_DISABLE_NETWORK)).should.not.throw()
  })

  it(<span class="hljs-string">'defaults to bitcoin (livenet) network'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> wallet = <span class="hljs-keyword">new</span> Wallet(CORRECT_TYPE, CORRECT_SECRET, OPTIONS_DISABLE_NETWORK)
    wallet._network.messagePrefix.should.equal(<span class="hljs-string">'\u0018Bitcoin Signed Message:\n'</span>)
    wallet._network.pubKeyHash.should.equal(<span class="hljs-number">0x00</span>)
    wallet._networkName.should.equal(<span class="hljs-string">'bitcoin'</span>)
  })

  it(<span class="hljs-string">'switches to testnet network when used as option'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> wallet = <span class="hljs-keyword">new</span> Wallet(CORRECT_TYPE, CORRECT_SECRET, <span class="hljs-built_in">Object</span>.assign({ <span class="hljs-attr">network</span>: <span class="hljs-string">'testnet'</span> }, OPTIONS_DISABLE_NETWORK))
    wallet._network.messagePrefix.should.equal(<span class="hljs-string">'\u0018Bitcoin Signed Message:\n'</span>)
    wallet._network.pubKeyHash.should.equal(<span class="hljs-number">0x6f</span>)
    wallet._networkName.should.equal(<span class="hljs-string">'testnet'</span>)
  })

  describe(<span class="hljs-string">'.create()'</span>, () =&gt; {
    describe(<span class="hljs-string">'Bitcoin electrum BIP39_BIP49'</span>, () =&gt; {
      <span class="hljs-keyword">const</span> TYPE_ID = <span class="hljs-string">'bitcoin_electrum_BIP39_BIP49'</span>
      <span class="hljs-keyword">const</span> CURRENCY = <span class="hljs-string">'BTC'</span>
      <span class="hljs-keyword">const</span> SECRET_TYPE = <span class="hljs-string">'BIP39_BIP49'</span>
      it(<span class="hljs-string">'creates a Wallet instance with the correct data'</span>, () =&gt; {
        <span class="hljs-keyword">const</span> wallet = Wallet.create(TYPE_ID, OPTIONS_DISABLE_NETWORK)
        wallet._type.currency.should.equal(CURRENCY)
        wallet._type.secretType.should.equal(SECRET_TYPE)
      })
    })

    describe(<span class="hljs-string">'Bitcoin electrum BIP49'</span>, () =&gt; {
      it(<span class="hljs-string">'creates a Wallet instance with the correct data'</span>, () =&gt; {
        <span class="hljs-keyword">const</span> TYPE_ID = <span class="hljs-string">'bitcoin_electrum_BIP49'</span>
        <span class="hljs-keyword">const</span> CURRENCY = <span class="hljs-string">'BTC'</span>
        <span class="hljs-keyword">const</span> SECRET_TYPE = <span class="hljs-string">'BIP49'</span>

        <span class="hljs-keyword">const</span> wallet = Wallet.create(TYPE_ID, OPTIONS_DISABLE_NETWORK)
        wallet._type.currency.should.equal(CURRENCY)
        wallet._type.secretType.should.equal(SECRET_TYPE)
      })
    })
  })

  describe(<span class="hljs-string">'Bitcoin electrum BIP39_BIP49 type'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> TYPE_ID = <span class="hljs-string">'bitcoin_electrum_BIP39_BIP49'</span>
    <span class="hljs-keyword">const</span> INCORRECT_SECRET_MNEMONIC = <span class="hljs-string">'i am not a correct secret seed'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>const CORRECT_SECRET_MNEMONIC2 = bip39.generateMnemonic()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> CORRECT_SECRET_MNEMONIC = <span class="hljs-string">'attend ordinary entire myth leg utility flat jacket trade smart despair clerk'</span>
    <span class="hljs-keyword">const</span> seed = bip39.mnemonicToSeed(CORRECT_SECRET_MNEMONIC)
    <span class="hljs-keyword">const</span> DERIVED_HD_NODE = bitcoin.HDNode.fromSeedBuffer(seed)
    <span class="hljs-keyword">const</span> PASSPHRASE = <span class="hljs-string">'this is a passphrase'</span>
    <span class="hljs-keyword">const</span> seedPassphrase = bip39.mnemonicToSeed(CORRECT_SECRET_MNEMONIC, PASSPHRASE)
    <span class="hljs-keyword">const</span> DERIVED_HD_NODE_WITH_PASSPHRASE = bitcoin.HDNode.fromSeedBuffer(seedPassphrase)

    it(<span class="hljs-string">'throws if no secret is provided'</span>, () =&gt; {
      ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(TYPE_ID)).should.throw()
    })

    it(<span class="hljs-string">'throws if secret seed is not correct'</span>, () =&gt; {
      ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(TYPE_ID, INCORRECT_SECRET_MNEMONIC)).should.throw()
    })

    it(<span class="hljs-string">'does not throw if secret seed is correct'</span>, () =&gt; {
      ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(TYPE_ID, CORRECT_SECRET_MNEMONIC, OPTIONS_DISABLE_NETWORK)).should.not.throw()
    })

    it(<span class="hljs-string">'derives the correct HD private key from mnemonic'</span>, <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> wallet = <span class="hljs-keyword">new</span> Wallet(TYPE_ID, CORRECT_SECRET_MNEMONIC, OPTIONS_DISABLE_NETWORK)
      <span class="hljs-keyword">await</span> wallet.onReady()
      wallet._rootHDNode.constructor.name.should.equal(<span class="hljs-string">'HDNode'</span>)
      wallet._rootHDNode.toString().should.equal(DERIVED_HD_NODE.toString())
    })

    it(<span class="hljs-string">'derives the correct HD private key from mnemonic and passphrase'</span>, <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> wallet = <span class="hljs-keyword">new</span> Wallet(TYPE_ID, {
        <span class="hljs-attr">seed</span>: CORRECT_SECRET_MNEMONIC,
        <span class="hljs-attr">passphrase</span>: PASSPHRASE
      }, OPTIONS_DISABLE_NETWORK)
      <span class="hljs-keyword">await</span> wallet.onReady()
      wallet._rootHDNode.constructor.name.should.equal(<span class="hljs-string">'HDNode'</span>)
      wallet._rootHDNode.toString().should.equal(DERIVED_HD_NODE_WITH_PASSPHRASE.toString())
    })
  })

  describe(<span class="hljs-string">'Bitcoin electrum BIP49 type'</span>, () =&gt; {
    <span class="hljs-keyword">const</span> TYPE_ID = <span class="hljs-string">'bitcoin_electrum_BIP49'</span>
    <span class="hljs-keyword">const</span> INCORRECT_SECRET_KEY = <span class="hljs-string">'i am not a correct secret key'</span>
    <span class="hljs-keyword">const</span> mnemonic = bip39.generateMnemonic()
    <span class="hljs-keyword">const</span> seed = bip39.mnemonicToSeed(mnemonic)
    <span class="hljs-keyword">const</span> hdNode = bitcoin.HDNode.fromSeedBuffer(seed)
    <span class="hljs-keyword">const</span> CORRECT_SECRET_KEY = hdNode.toBase58()

    it(<span class="hljs-string">'throws if no secret is provided'</span>, () =&gt; {
      ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(TYPE_ID)).should.throw()
    })

    it(<span class="hljs-string">'throws if secret seed is not correct'</span>, () =&gt; {
      ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(TYPE_ID, INCORRECT_SECRET_KEY)).should.throw()
    })

    it(<span class="hljs-string">'does not throw if secret seed is correct'</span>, () =&gt; {
      ;<span class="hljs-function">(<span class="hljs-params">(</span>) =&gt;</span> <span class="hljs-keyword">new</span> Wallet(TYPE_ID, CORRECT_SECRET_KEY, OPTIONS_DISABLE_NETWORK)).should.not.throw()
    })

    it(<span class="hljs-string">'stores the correct HD private key'</span>, <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> wallet = <span class="hljs-keyword">new</span> Wallet(TYPE_ID, CORRECT_SECRET_KEY, OPTIONS_DISABLE_NETWORK)
      <span class="hljs-keyword">await</span> wallet.onReady()
      wallet._rootHDNode.constructor.name.should.equal(<span class="hljs-string">'HDNode'</span>)

      wallet._rootHDNode.toBase58().should.equal(CORRECT_SECRET_KEY)
    })
  })
})</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
